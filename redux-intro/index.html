<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5422df916e90832d9ac9.css">*,:after,:before{box-sizing:border-box}body{color:#3d3d3d;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Helvetica Neue,Arial,sans-serif;font-size:16px;line-height:1.625;text-rendering:optimizeLegibility;margin:0 auto;padding:20px;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}@media (min-width:768px){body{font-size:18px}}a{color:#0366d6;text-decoration:none}a:hover{text-decoration:underline}p{margin:0 0 1em}#layout{max-width:40.25rem;margin-left:auto;margin-right:auto}@media (min-width:1024px){#layout{max-width:46rem}#container{width:87.5%}}h1,h2,h3,h4{line-height:normal;margin:0;font-weight:500}h1{font-size:2em}h2,h3,h4{margin-top:1.5em;margin-bottom:.5em}h2{font-size:1.5em}h3{font-size:1.25em}h4{font-size:1.05em}ol,ul{padding-left:0;margin:5px 0 1em;list-style-type:none}ol>li,ul>li{text-indent:0;margin:.3em 0}p+ol,p+ul{margin-top:-.7em}ol{list-style-type:decimal}hr{background-color:#e1e4e8;border:0;height:1px;margin:24px 0;padding:0}.vim-cursor{display:inline-block;background-color:#5f5f5e;color:#fff;margin-bottom:-5px;margin-left:3px;width:10px;height:18px}blockquote{margin:1.5em 0 1.5em 1.8em;color:#5a5a5a;position:relative;font-style:italic}blockquote:before{font-family:georgia,serif;font-size:3.6em;position:absolute;content:"\201C";line-height:1em;font-style:normal;left:-.5em;top:0}cite{display:block;text-align:right;color:#3d3d3d}cite:before{content:"\2014   "}table{border:2px solid #000;border-right:none;border-left:none;border-collapse:collapse;min-width:100%;margin:2em auto}@media (min-width:576px){table{min-width:20rem}}td,th{padding:5px 10px;text-align:left}th{border-bottom:1px solid #000}.mono{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}#post-list .date{color:#aaa}figure{margin:0 0 1.4em}#blog-post figure{margin-top:1.4em}figcaption:before{font-variant:small-caps;content:"Figure \2013   "}figcaption{text-align:center;margin-top:1em;margin-bottom:1.4em}iframe{border:none;width:1px;min-width:100%;margin:0 auto 1em}img{max-width:100%;display:block;margin:0 auto}strong{font-weight:500}.katex-display{overflow-x:auto;overflow-y:hidden}code[class*=language-],pre[class*=language-]{color:#333;background:none;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#fafafa;border:1px solid #eee}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-makefile .token.symbol,.language-markdown .token.url{color:#795da3}.language-makefile .token.variable{color:#183691}.language-bash .token.keyword,.language-makefile .token.builtin{color:#0086b3}code{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}:not(pre)>code[class*=language-],pre[class*=language-]{font-size:.9em}.gatsby-highlight pre[class*=language-]:before{background:#ddd;border-radius:0 0 4px 4px;font-size:.75rem;font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;letter-spacing:.075em;line-height:1;padding:.25rem .5rem;position:absolute;right:1.5rem;text-align:right;top:0}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}#blog-post nav>ul{padding:0}#blog-post-content ol,#blog-post-content ul{padding-left:1.5em}#blog-post-content ul>li{list-style-type:disc}#blog-post-footer{display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0}</style><meta name="generator" content="Gatsby 2.17.7"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="Vincent Cordobes feed" href="/rss.xml"/><title data-react-helmet="true">Architecture Redux | Vincent Cordobes</title><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous"/><meta data-react-helmet="true" name="google-site-verification" content="kjM2mfXvQ9XJ7BqEPTHNHWZ62wJsC5G_GtuPX1oy0EY"/><meta data-react-helmet="true" name="description" content="Des bons concepts"/><meta data-react-helmet="true" property="og:url" content="https://vincentcordobes.github.io/redux-intro/"/><meta data-react-helmet="true" property="og:title" content="Architecture Redux"/><meta data-react-helmet="true" name="og:description" content="Des bons concepts"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@VincentCordobes"/><meta data-react-helmet="true" name="twitter:title" content="Architecture Redux"/><meta data-react-helmet="true" name="twitter:description" content="Des bons concepts"/><link as="script" rel="preload" href="/webpack-runtime-9bb9575fb4004247a55b.js"/><link as="script" rel="preload" href="/app-37a413c6df3081cb411c.js"/><link as="script" rel="preload" href="/styles-fd2a1a91c9ce33941704.js"/><link as="script" rel="preload" href="/commons-c21c5fd4ad0fc15953e9.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-2699ef8067ee57e67702.js"/><link as="fetch" rel="preload" href="/page-data/redux-intro/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div id="layout"><div id="container"><div id="blog-post"><header><nav><ul><li><a rel="home" href="/">Home</a></li></ul></nav></header><h1>Architecture Redux</h1><p><small class="mono">June 17, 2016</small></p><div id="blog-post-content"><p><em>React</em> fournit seulement un moyen de dessiner de manière efficace des
composants en fonction de données d’entrées.</p>
<p>Flux est un <em>pattern</em> permettant de gérer <strong>l’état d’une application</strong> qui garanti un flux de données
unidirectionnel (<em>one way databinding</em>) Redux est l’implémentation
la plus populaire.</p>
<p>Redux, met en scène 3 principes :</p>
<ul>
<li><strong>une seule source de vérité</strong> : le <em>state</em> de l’application est maintenu dans une structure de données à l’intérieur d’un seul store</li>
<li>le state est <strong>immutable</strong> : La seule manière de modifier le <em>state</em> est via l’émission d’une <strong>action</strong>, un objet décrivant la modification à apporter. Toutes les modifications sont centralisées et se produisent une à une, évitant ainsi les problèmes de concurrence</li>
<li>les modifications sont effectuées à l’aide de <strong>fonction pures</strong> appelées <strong>reducers</strong></li>
</ul>
<figure><img style="width:max-content" src="/eec49feb72d494c46fe2f4afae80bd77/flux.svg"><figcaption>Architecture Redux</figcaption></figure>
<p>Le schéma illustre le flux unidirectionnel des données dans cette architecture : des <strong>actions</strong> sont <em>dispatchées</em> et traitées par le <strong>reducer</strong>, qui se charge de mettre à jour le store. Toutes les vues (ici les composants react) abonnées au store se mettent à jour en conséquence. Ces vues peuvent également <em>dispatcher</em> des actions et ainsi de suite.</p>
<h3 id="actions-et-actions-creators"><a href="#actions-et-actions-creators" aria-label="actions et actions creators permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Actions et Actions creators</h3>
<p>Les actions sont des paquets de données envoyés au <em>store</em>. Elles
sont la seule source d’information du store. Une action est envoyée au
store grâce à la fonction <code class="language-text">store.dispatch</code>.</p>
<p>Voici un exemple d’action qui représente le
changement de nom d’une personne :</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'CHANGE_NAME'</span><span class="token punctuation">,</span>
  payload<span class="token punctuation">:</span> <span class="token string">'Vince'</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Si cette action se révèle être utilisée souvent, nous pouvons écrire une fonction qui se chargera de la créer.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">changeName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'CHANGE_NAME'</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>On appelle ces fonctions des <strong>action creator</strong>. Elles rendent les actions réutilisables et facilement testables.
Les actions peuvent être “dispatchées” avec : <code class="language-text">dispatch(changeName(&#39;Vincent&#39;))</code></p>
<h3 id="reducer"><a href="#reducer" aria-label="reducer permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reducer</h3>
<p>Les actions décrivent le fait que quelque chose s’est passé mais ne
spécifient pas la manière dont le store doit être modifié. C’est le rôle
du reducer, une <strong>fonction pure</strong> qui prend en
paramètre le <em>state</em>, une action, et retourne le nouveau <em>state</em>.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">(previousState, action) =&gt; nextState</code></pre></div>
<p>Le <em>reducer</em> est une fonction pure, par conséquent il ne doit <strong>jamais</strong>:</p>
<ul>
<li>modifier directement ses arguments</li>
<li>effectuer des opérations ayant des effets de bord tel que des appels à une api</li>
<li>appeler des fonctions impures telles que <code class="language-text">Date.now()</code> etc…</li>
</ul>
<p>Il est uniquement chargé de calculer le <em>nextState</em>.</p>
<h4 id="✘-exemple-un-reducer-incorrect-mutation-du-state-interdite"><a href="#%E2%9C%98-exemple-un-reducer-incorrect-mutation-du-state-interdite" aria-label="✘ exemple un reducer incorrect mutation du state interdite permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>✘ Exemple: un reducer incorrect, mutation du state INTERDITE!</h4>
<p>Le <em>state</em> est muté.
La propriété du <em>state</em> étant modifiée directement (l.4),
les composants abonnés à cette partie du <em>state</em> ne se mettrons pas à jour et ignorerons cette modification.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'CHANGE_NAME'</span><span class="token punctuation">:</span>
      state<span class="token punctuation">.</span>name <span class="token operator">=</span> action<span class="token punctuation">.</span>name <span class="token comment">// INTERDIT !!</span>
      <span class="token keyword">return</span> state 
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h4 id="-exemple-un-reducer-correct"><a href="#-exemple-un-reducer-correct" aria-label=" exemple un reducer correct permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>✔ Exemple Un reducer correct</h4>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'CHANGE_NAME'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> action<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em><strong>Note</strong> : On utilise ici l’opérateur object spread <code class="language-text">...</code>, une syntaxe d’ECMAScript 2016, qui permet de copier les propriétés d’un
objet dans un nouvel objet d’une manière plus succincte. Nous pouvons également utiliser des bibliothèques qui garantissent l’immutabilité telles que <a href="https://github.com/facebook/immutable-js/">immutable.js</a> développée par Facebook</em></p>
<!-- <h6>TODO: combineReducer pour réduire le boilerplate</h6> -->
<h3 id="store"><a href="#store" aria-label="store permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Store</h3>
<p>Le <em>store</em> est un objet qui :</p>
<ul>
<li>maintient le <em>state</em> de l’application</li>
<li>permet l’accès à ce <em>state</em> via <code class="language-text">getState()</code></li>
<li>permet de mettre à jour le <em>state</em> via <code class="language-text">dispatch(action)</code></li>
<li>permet d’abonner des composants via <code class="language-text">subscribe(listener)</code> (composants notifiés lorsque le <em>state</em> subit une modification)</li>
</ul>
<h3 id="async-actions"><a href="#async-actions" aria-label="async actions permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Async Actions</h3>
<p>Afin d’orchestrer des flux asynchrones (par exemple, les appels réseaux) nous pouvons utiliser le <em>middleware</em> <em>Redux-thunk</em>.
<em>Ce _middleware</em> permet de traiter les actions étant des fonctions (appelées <em>thunk action</em>).
Une action <em>thunk</em> ne doit pas forcément être pure et peut avoir des effets de bords. Les fonctions <em>dispatch</em> et <em>getState</em> du store lui sont passées en argument, ce qui lui donne la possibilité de <em>dispatcher</em> d’autres <em>actions</em> et d’accéder au <em>state</em>.</p>
<h4 id="exemple-dun-thunk-action-creator-qui-renvoie-une-fonction-"><a href="#exemple-dun-thunk-action-creator-qui-renvoie-une-fonction-" aria-label="exemple dun thunk action creator qui renvoie une fonction  permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exemple d’un thunk action creator qui renvoie une fonction :</h4>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">whatIsMyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchNameRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://vincent.cordobes/name'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchNameSuccess</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchNameError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>L’exemple ci-dessus met en évidence une <em>action creator</em> qui retourne une fonction. Des actions marquant le début, le succès ou une erreur de l’appel (l.5) à l’API sont “dispatchées” (l.3, l.7, l.9) permettant de mettre à jour le <em>store</em> en fonction de l’avancement de la requête.</p>
<p><em>Remarques relativement au code ci-dessus : syntaxe avec les mots clés async/await. Cette syntaxe fait son apparition dans ECMAScript 2017. En résumé, <code class="language-text">await</code> permet d’attendre la résolution d’une promesse et ne peux être utilisé que dans une fonction préfixée par <code class="language-text">async</code> (elle-même renverra à son tour une promesse) Il permet d’écrire le code asynchrone de javascript à la manière d’un code synchrone.</em></p>
<h3 id="selecteurs"><a href="#selecteurs" aria-label="selecteurs permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Selecteurs</h3>
<p>Afin de comprendre l’utilité des sélecteurs, prenons un exemple.
Considérons une liste de personnes, une recherche (par nom) et des filtres (sexe, age, etc…) sur ces personnes.</p>
<p>En suivant les principes <em>Redux</em>, le <em>store</em> contient les données et les critères de recherche.
À partir de ces éléments nous pouvons calculer la liste filtrée à afficher. </p>
<p>Une bonne pratique, concernant le <em>state</em>, est de contenir seulement des donnée minimisée, c’est-à-dire des données ne pouvant pas être obtenues à partir d’autres données.
Les états dérivés ne doivent pas être présents dans le <em>state</em>.</p>
<figure>
<img src="/bc881c9cf7496038f4f1a3154c288f66/selectors0.svg" width="300">
<figcaption>React filtre la data au render</figcaption>
</figure>
<p>Le <em>bon</em> endroit pour filtrer et afficher cette liste est donc la méthode <em>render</em>.
Ainsi, si  un critère de recherche ou si les données changent,
le composant exécute la méthode <code class="language-text">render</code>, filtre les données et les affiche.
Il en résulte une <em>UI</em> toujours synchronisée avec le <em>state</em>. </p>
<p>Cette technique présente néanmoins un inconvénient.
Supposons qu’une <em>props</em> autre que les filtres et la liste de personnes, change :
le filtrage de la liste se fera donc, inutilement, à chaque <em>update</em> du composant.</p>
<p>La complexité de ce filtrage étant du <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>, cela n’est pas très gênant si la taille des données à filtre reste modérée. </p>
<p>Cependant, des listes de données potentiellement grandes ou même un calcul plus  complexe dégraderaient fortement les performances de l’application.</p>
<p>C’est ici qu’entrent en jeu les selectors :</p>
<figure>
  <img src="/1dca7c8fdfec91367a93fb1aa35a8ac4/selectors.svg" width="328">
  <figcaption>Un selecteur filtre la data pour la passer au composant</figcaption>
</figure>
<p>Les <strong>selectors calculent des données dérivées</strong>. Ils permettent au state de ne stocker que les données minimisée.
Ils sont efficaces et ne sont pas recalculés si les arguments restent les mêmes → ils sont <strong>mémoisés</strong>.
Enfin ils sont <em>composables</em>, c’est-à-dire qu’ils peuvent être utilisés en
entrées d’autres selectors.
Ainsi toute la complexité est <em>déplacée</em> à l’extérieur et prise en charge par les selectors,</p>
<p>Les <em>selectors</em> jouent le rôle d’<em>api</em>, permettant un accès au <em>state</em>.
Les composants React ne connaissent que cette interface.
Une conséquence directe est le <em>découplage</em> de ces composants vis-à-vis de la <em>forme</em> du <em>state</em>.
Un autre bénéfice est la simplification du code des composants React.</p>
<h4 id="exemple-avec-la-bibliothèque-reselect"><a href="#exemple-avec-la-biblioth%C3%A8que-reselect" aria-label="exemple avec la bibliothèque reselect permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exemple avec la bibliothèque <a href="https://github.com/reactjs/reselect">reselect</a></h4>
<h5 id="définition-des-selectors"><a href="#d%C3%A9finition-des-selectors" aria-label="définition des selectors permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Définition des <em>selectors</em></h5>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">getUsers</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>users
<span class="token keyword">const</span> <span class="token function-variable function">getSearchTerm</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>searchTerm

<span class="token comment">// Memoized selector</span>
<span class="token keyword">const</span> getFilteredUsers <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  getUsers<span class="token punctuation">,</span>
  getSearchTerm<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">users<span class="token punctuation">,</span> searchTerm</span><span class="token punctuation">)</span> <span class="token operator">=></span> users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
    <span class="token parameter">user</span> <span class="token operator">=></span> user<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>searchTerm<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h5 id="définition-du-composant-react"><a href="#d%C3%A9finition-du-composant-react" aria-label="définition du composant react permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Définition du composant React</h5>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">UserList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> filteredUsers <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>ul<span class="token operator">></span>
    <span class="token punctuation">{</span>filteredUsers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h5 id="connexion-du-composant"><a href="#connexion-du-composant" aria-label="connexion du composant permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connexion du composant</h5>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  filteredUsers<span class="token punctuation">:</span> <span class="token function">getFilteredUsers</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UserList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>Note</strong> : Redux est une bibliothèque dogmatique mettant en scène plusieurs concepts et <em>patterns</em> (immutabilités, flux unidirectionnel etc…) et ces principes sous-jacents peuvent parfaitement s’appliquer à d’autres architectures.</p>
<h3 id="références"><a href="#r%C3%A9f%C3%A9rences" aria-label="références permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Références</h3>
<ul>
  <li>Redux doc. <em>https://redux.js.org</em></li>
  <li>React and flux in production best practices. <em>https://medium.com/@delveeng/react-and-flux-in-production-best-practices-c87766c57cb6#.elbdrmo4f</em></li>
</ul></div><div><span style="font-size:0"></span><div class="vim-cursor"></div></div><hr/><ul id="blog-post-footer"><li><a rel="prev" href="/react-intro/">← <!-- -->Introduction à React</a></li><li><a rel="next" href="/ritter-toussaint/">Cercle et rectangle minimum<!-- --> →</a></li></ul></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-125838540-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/redux-intro/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-37a413c6df3081cb411c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-2699ef8067ee57e67702.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6a2f879a28a122951c4f.js"],"component---src-pages-activities-js":["/component---src-pages-activities-js-c6ed1817079361114c52.js"],"component---src-pages-git-rebase-figure-1-js":["/component---src-pages-git-rebase-figure-1-js-9ebd61c158377a9a5040.js"],"component---src-pages-git-rebase-figure-2-js":["/component---src-pages-git-rebase-figure-2-js-9e611b1fbf75fcb4ee2f.js"],"component---src-pages-git-rebase-figure-3-js":["/component---src-pages-git-rebase-figure-3-js-7374ef7124bc23ddfc57.js"],"component---src-pages-git-js":["/component---src-pages-git-js-425d1935b8bddc2b6479.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d0f78fa5042f052868b8.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-2699ef8067ee57e67702.js" async=""></script><script src="/commons-c21c5fd4ad0fc15953e9.js" async=""></script><script src="/styles-fd2a1a91c9ce33941704.js" async=""></script><script src="/app-37a413c6df3081cb411c.js" async=""></script><script src="/webpack-runtime-9bb9575fb4004247a55b.js" async=""></script></body></html>