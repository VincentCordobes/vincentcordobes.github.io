{"componentChunkName":"component---src-templates-blog-post-js","path":"/redux-intro/","result":{"data":{"site":{"siteMetadata":{"title":"Vincent Cordobes","siteUrl":"https://vincentcordobes.github.io","author":"Vincent Cordobes"}},"markdownRemark":{"id":"20786d62-3255-5f37-935a-417f4e81c22a","html":"<p><em>React</em> fournit seulement un moyen de dessiner de manière efficace des\ncomposants en fonction de données d’entrées.</p>\n<p>Flux est un <em>pattern</em> permettant de gérer <strong>l’état d’une application</strong> qui garanti un flux de données\nunidirectionnel (<em>one way databinding</em>) Redux est l’implémentation\nla plus populaire.</p>\n<p>Redux, met en scène 3 principes :</p>\n<ul>\n<li><strong>une seule source de vérité</strong> : le <em>state</em> de l’application est maintenu dans une structure de données à l’intérieur d’un seul store</li>\n<li>le state est <strong>immutable</strong> : La seule manière de modifier le <em>state</em> est via l’émission d’une <strong>action</strong>, un objet décrivant la modification à apporter. Toutes les modifications sont centralisées et se produisent une à une, évitant ainsi les problèmes de concurrence</li>\n<li>les modifications sont effectuées à l’aide de <strong>fonction pures</strong> appelées <strong>reducers</strong></li>\n</ul>\n<figure><img style=\"width:max-content\" src=\"/eec49feb72d494c46fe2f4afae80bd77/flux.svg\"><figcaption>Architecture Redux</figcaption></figure>\n<p>Le schéma illustre le flux unidirectionnel des données dans cette architecture : des <strong>actions</strong> sont <em>dispatchées</em> et traitées par le <strong>reducer</strong>, qui se charge de mettre à jour le store. Toutes les vues (ici les composants react) abonnées au store se mettent à jour en conséquence. Ces vues peuvent également <em>dispatcher</em> des actions et ainsi de suite.</p>\n<h3 id=\"actions-et-actions-creators\" style=\"position:relative;\"><a href=\"#actions-et-actions-creators\" aria-label=\"actions et actions creators permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Actions et Actions creators</h3>\n<p>Les actions sont des paquets de données envoyés au <em>store</em>. Elles\nsont la seule source d’information du store. Une action est envoyée au\nstore grâce à la fonction <code class=\"language-text\">store.dispatch</code>.</p>\n<p>Voici un exemple d’action qui représente le\nchangement de nom d’une personne :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'CHANGE_NAME'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">payload</span><span class=\"token operator\">:</span> <span class=\"token string\">'Vince'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Si cette action se révèle être utilisée souvent, nous pouvons écrire une fonction qui se chargera de la créer.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">changeName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'CHANGE_NAME'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">payload</span><span class=\"token operator\">:</span> name<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On appelle ces fonctions des <strong>action creator</strong>. Elles rendent les actions réutilisables et facilement testables.\nLes actions peuvent être “dispatchées” avec : <code class=\"language-text\">dispatch(changeName('Vincent'))</code></p>\n<h3 id=\"reducer\" style=\"position:relative;\"><a href=\"#reducer\" aria-label=\"reducer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reducer</h3>\n<p>Les actions décrivent le fait que quelque chose s’est passé mais ne\nspécifient pas la manière dont le store doit être modifié. C’est le rôle\ndu reducer, une <strong>fonction pure</strong> qui prend en\nparamètre le <em>state</em>, une action, et retourne le nouveau <em>state</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(previousState, action) => nextState</code></pre></div>\n<p>Le <em>reducer</em> est une fonction pure, par conséquent il ne doit <strong>jamais</strong>:</p>\n<ul>\n<li>modifier directement ses arguments</li>\n<li>effectuer des opérations ayant des effets de bord tel que des appels à une api</li>\n<li>appeler des fonctions impures telles que <code class=\"language-text\">Date.now()</code> etc…</li>\n</ul>\n<p>Il est uniquement chargé de calculer le <em>nextState</em>.</p>\n<h4 id=\"-exemple-un-reducer-incorrect-mutation-du-state-interdite\" style=\"position:relative;\"><a href=\"#-exemple-un-reducer-incorrect-mutation-du-state-interdite\" aria-label=\" exemple un reducer incorrect mutation du state interdite permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✘ Exemple: un reducer incorrect, mutation du state INTERDITE!</h4>\n<p>Le <em>state</em> est muté.\nLa propriété du <em>state</em> étant modifiée directement (l.4),\nles composants abonnés à cette partie du <em>state</em> ne se mettrons pas à jour et ignorerons cette modification.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'CHANGE_NAME'</span><span class=\"token operator\">:</span>\n      state<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span>name <span class=\"token comment\">// INTERDIT !!</span>\n      <span class=\"token keyword\">return</span> state \n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> state\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"-exemple-un-reducer-correct\" style=\"position:relative;\"><a href=\"#-exemple-un-reducer-correct\" aria-label=\" exemple un reducer correct permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ Exemple Un reducer correct</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'CHANGE_NAME'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> action<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> state\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em><strong>Note</strong> : On utilise ici l’opérateur object spread <code class=\"language-text\">...</code>, une syntaxe d’ECMAScript 2016, qui permet de copier les propriétés d’un\nobjet dans un nouvel objet d’une manière plus succincte. Nous pouvons également utiliser des bibliothèques qui garantissent l’immutabilité telles que <a href=\"https://github.com/facebook/immutable-js/\">immutable.js</a> développée par Facebook</em></p>\n<!-- <h6>TODO: combineReducer pour réduire le boilerplate</h6> -->\n<h3 id=\"store\" style=\"position:relative;\"><a href=\"#store\" aria-label=\"store permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Store</h3>\n<p>Le <em>store</em> est un objet qui :</p>\n<ul>\n<li>maintient le <em>state</em> de l’application</li>\n<li>permet l’accès à ce <em>state</em> via <code class=\"language-text\">getState()</code></li>\n<li>permet de mettre à jour le <em>state</em> via <code class=\"language-text\">dispatch(action)</code></li>\n<li>permet d’abonner des composants via <code class=\"language-text\">subscribe(listener)</code> (composants notifiés lorsque le <em>state</em> subit une modification)</li>\n</ul>\n<h3 id=\"async-actions\" style=\"position:relative;\"><a href=\"#async-actions\" aria-label=\"async actions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Async Actions</h3>\n<p>Afin d’orchestrer des flux asynchrones (par exemple, les appels réseaux) nous pouvons utiliser le <em>middleware</em> <em>Redux-thunk</em>.\n<em>Ce _middleware</em> permet de traiter les actions étant des fonctions (appelées <em>thunk action</em>).\nUne action <em>thunk</em> ne doit pas forcément être pure et peut avoir des effets de bords. Les fonctions <em>dispatch</em> et <em>getState</em> du store lui sont passées en argument, ce qui lui donne la possibilité de <em>dispatcher</em> d’autres <em>actions</em> et d’accéder au <em>state</em>.</p>\n<h4 id=\"exemple-dun-thunk-action-creator-qui-renvoie-une-fonction-\" style=\"position:relative;\"><a href=\"#exemple-dun-thunk-action-creator-qui-renvoie-une-fonction-\" aria-label=\"exemple dun thunk action creator qui renvoie une fonction  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exemple d’un thunk action creator qui renvoie une fonction :</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">whatIsMyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">dispatch<span class=\"token punctuation\">,</span> getState</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetchNameRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://vincent.cordobes/name'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetchNameSuccess</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetchNameError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>L’exemple ci-dessus met en évidence une <em>action creator</em> qui retourne une fonction. Des actions marquant le début, le succès ou une erreur de l’appel (l.5) à l’API sont “dispatchées” (l.3, l.7, l.9) permettant de mettre à jour le <em>store</em> en fonction de l’avancement de la requête.</p>\n<p><em>Remarques relativement au code ci-dessus : syntaxe avec les mots clés async/await. Cette syntaxe fait son apparition dans ECMAScript 2017. En résumé, <code class=\"language-text\">await</code> permet d’attendre la résolution d’une promesse et ne peux être utilisé que dans une fonction préfixée par <code class=\"language-text\">async</code> (elle-même renverra à son tour une promesse) Il permet d’écrire le code asynchrone de javascript à la manière d’un code synchrone.</em></p>\n<h3 id=\"selecteurs\" style=\"position:relative;\"><a href=\"#selecteurs\" aria-label=\"selecteurs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Selecteurs</h3>\n<p>Afin de comprendre l’utilité des sélecteurs, prenons un exemple.\nConsidérons une liste de personnes, une recherche (par nom) et des filtres (sexe, age, etc…) sur ces personnes.</p>\n<p>En suivant les principes <em>Redux</em>, le <em>store</em> contient les données et les critères de recherche.\nÀ partir de ces éléments nous pouvons calculer la liste filtrée à afficher. </p>\n<p>Une bonne pratique, concernant le <em>state</em>, est de contenir seulement des donnée minimisée, c’est-à-dire des données ne pouvant pas être obtenues à partir d’autres données.\nLes états dérivés ne doivent pas être présents dans le <em>state</em>.</p>\n<figure>\n<img src=\"/bc881c9cf7496038f4f1a3154c288f66/selectors0.svg\" width=\"300\">\n<figcaption>React filtre la data au render</figcaption>\n</figure>\n<p>Le <em>bon</em> endroit pour filtrer et afficher cette liste est donc la méthode <em>render</em>.\nAinsi, si  un critère de recherche ou si les données changent,\nle composant exécute la méthode <code class=\"language-text\">render</code>, filtre les données et les affiche.\nIl en résulte une <em>UI</em> toujours synchronisée avec le <em>state</em>. </p>\n<p>Cette technique présente néanmoins un inconvénient.\nSupposons qu’une <em>props</em> autre que les filtres et la liste de personnes, change :\nle filtrage de la liste se fera donc, inutilement, à chaque <em>update</em> du composant.</p>\n<p>La complexité de ce filtrage étant du <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">)</span></span></span></span>, cela n’est pas très gênant si la taille des données à filtre reste modérée. </p>\n<p>Cependant, des listes de données potentiellement grandes ou même un calcul plus  complexe dégraderaient fortement les performances de l’application.</p>\n<p>C’est ici qu’entrent en jeu les selectors :</p>\n<figure>\n  <img src=\"/1dca7c8fdfec91367a93fb1aa35a8ac4/selectors.svg\" width=\"328\">\n  <figcaption>Un selecteur filtre la data pour la passer au composant</figcaption>\n</figure>\n<p>Les <strong>selectors calculent des données dérivées</strong>. Ils permettent au state de ne stocker que les données minimisée.\nIls sont efficaces et ne sont pas recalculés si les arguments restent les mêmes → ils sont <strong>mémoisés</strong>.\nEnfin ils sont <em>composables</em>, c’est-à-dire qu’ils peuvent être utilisés en\nentrées d’autres selectors.\nAinsi toute la complexité est <em>déplacée</em> à l’extérieur et prise en charge par les selectors,</p>\n<p>Les <em>selectors</em> jouent le rôle d’<em>api</em>, permettant un accès au <em>state</em>.\nLes composants React ne connaissent que cette interface.\nUne conséquence directe est le <em>découplage</em> de ces composants vis-à-vis de la <em>forme</em> du <em>state</em>.\nUn autre bénéfice est la simplification du code des composants React.</p>\n<h4 id=\"exemple-avec-la-bibliothèque-reselect\" style=\"position:relative;\"><a href=\"#exemple-avec-la-biblioth%C3%A8que-reselect\" aria-label=\"exemple avec la bibliothèque reselect permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exemple avec la bibliothèque <a href=\"https://github.com/reactjs/reselect\">reselect</a></h4>\n<h5 id=\"définition-des-selectors\" style=\"position:relative;\"><a href=\"#d%C3%A9finition-des-selectors\" aria-label=\"définition des selectors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Définition des <em>selectors</em></h5>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUsers</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>users\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getSearchTerm</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>searchTerm\n\n<span class=\"token comment\">// Memoized selector</span>\n<span class=\"token keyword\">const</span> getFilteredUsers <span class=\"token operator\">=</span> <span class=\"token function\">createSelector</span><span class=\"token punctuation\">(</span>\n  getUsers<span class=\"token punctuation\">,</span>\n  getSearchTerm<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">users<span class=\"token punctuation\">,</span> searchTerm</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> users<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>searchTerm<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"définition-du-composant-react\" style=\"position:relative;\"><a href=\"#d%C3%A9finition-du-composant-react\" aria-label=\"définition du composant react permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Définition du composant React</h5>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">UserList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> filteredUsers <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>filteredUsers<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"connexion-du-composant\" style=\"position:relative;\"><a href=\"#connexion-du-composant\" aria-label=\"connexion du composant permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connexion du composant</h5>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token literal-property property\">filteredUsers</span><span class=\"token operator\">:</span> <span class=\"token function\">getFilteredUsers</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>UserList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Note</strong> : Redux est une bibliothèque dogmatique mettant en scène plusieurs concepts et <em>patterns</em> (immutabilités, flux unidirectionnel etc…) et ces principes sous-jacents peuvent parfaitement s’appliquer à d’autres architectures.</p>\n<h3 id=\"références\" style=\"position:relative;\"><a href=\"#r%C3%A9f%C3%A9rences\" aria-label=\"références permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Références</h3>\n<ul>\n  <li>Redux doc. <em>https://redux.js.org</em></li>\n  <li>React and flux in production best practices. <em>https://medium.com/@delveeng/react-and-flux-in-production-best-practices-c87766c57cb6#.elbdrmo4f</em></li>\n</ul>","frontmatter":{"title":"Architecture Redux","date":"June 17, 2016","description":"Redux est une bibliothèque permettant de gérer l'état d'une application","thumbnail":null},"fields":{"slug":"/redux-intro/"}}},"pageContext":{"slug":"/redux-intro/","previous":{"fields":{"slug":"/react-intro/"},"frontmatter":{"title":"Introduction à React","draft":null}},"next":{"fields":{"slug":"/ritter-toussaint/"},"frontmatter":{"title":"Cercle et rectangle minimum","draft":false}}}},"staticQueryHashes":["336482444"]}